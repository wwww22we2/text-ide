<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœï¸ ç¼–è¾‘ä»»åŠ¡ - Todo List</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1><i class="fas fa-edit"></i> ç¼–è¾‘ä»»åŠ¡</h1>
            <a href="{{ url_for('index') }}" class="back-btn">
                <i class="fas fa-arrow-left"></i> è¿”å›ä¸»é¡µ
            </a>
        </header>

        <!-- Flash æ¶ˆæ¯ -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash-message flash-{{ category }}">
                            <i class="fas fa-info-circle"></i>
                            {{ message }}
                            <button class="close-flash">&times;</button>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <!-- ç¼–è¾‘è¡¨å• -->
        <div class="edit-form-container">
            <div class="task-info">
                <h3>ä»»åŠ¡ä¿¡æ¯</h3>
                <p><strong>åˆ›å»ºæ—¶é—´:</strong> {{ todo.created_at | format_datetime }}</p>
                {% if todo.completed_at %}
                    <p><strong>å®Œæˆæ—¶é—´:</strong> {{ todo.completed_at | format_datetime }}
                        <span class="relative-time">({{ todo.completed_at | relative_time }})</span>
                    </p>
                {% endif %}
                <p><strong>çŠ¶æ€:</strong> 
                    {% if todo.completed %}
                        <span class="status-completed">âœ… å·²å®Œæˆ</span>
                    {% else %}
                        <span class="status-pending">â³ å¾…å®Œæˆ</span>
                    {% endif %}
                </p>
                {% if todo.completed %}
                    <div class="completion-info">
                        <i class="fas fa-check-circle"></i>
                        <span>æ­¤ä»»åŠ¡å·²äº {{ todo.completed_at | format_datetime }} å®Œæˆ</span>
                        {% set completion_time = todo.completed_at | relative_time %}
                        {% if completion_time %}
                            <span class="completion-badge">{{ completion_time }}</span>
                        {% endif %}
                    </div>
                {% endif %}
            </div>

            <form method="POST" class="edit-form">
                <div class="form-group">
                    <label for="content">ä»»åŠ¡å†…å®¹</label>
                    <textarea name="content" 
                              id="content" 
                              class="todo-textarea" 
                              required 
                              maxlength="200" 
                              placeholder="è¯·è¾“å…¥ä»»åŠ¡å†…å®¹...">{{ todo.content }}</textarea>
                    <div class="char-counter">
                        <span id="char-count">{{ todo.content|length }}</span>/200
                    </div>
                </div>

                <div class="form-group">
                    <label for="priority">ä¼˜å…ˆçº§</label>
                    <select name="priority" id="priority" class="priority-select">
                        <option value="low" {{ 'selected' if todo.priority == 'low' else '' }}>ğŸŸ¢ ä½ä¼˜å…ˆçº§</option>
                        <option value="medium" {{ 'selected' if todo.priority == 'medium' else '' }}>ğŸŸ¡ ä¸­ä¼˜å…ˆçº§</option>
                        <option value="high" {{ 'selected' if todo.priority == 'high' else '' }}>ğŸ”´ é«˜ä¼˜å…ˆçº§</option>
                    </select>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> ä¿å­˜æ›´æ”¹
                    </button>
                    <a href="{{ url_for('index') }}" class="btn btn-secondary">
                        <i class="fas fa-times"></i> å–æ¶ˆ
                    </a>
                </div>
            </form>

            <!-- å¿«æ·æ“ä½œ -->
            <div class="quick-actions">
                <h3>å¿«æ·æ“ä½œ</h3>
                <div class="quick-action-buttons">
                    {% if not todo.completed %}
                        <a href="{{ url_for('complete', todo_id=todo.id) }}" 
                           class="btn btn-success">
                            <i class="fas fa-check"></i> æ ‡è®°ä¸ºå®Œæˆ
                        </a>
                    {% else %}
                        <a href="{{ url_for('uncomplete', todo_id=todo.id) }}" 
                           class="btn btn-warning">
                            <i class="fas fa-undo"></i> æ ‡è®°ä¸ºæœªå®Œæˆ
                        </a>
                    {% endif %}
                    <a href="{{ url_for('delete', todo_id=todo.id) }}" 
                       class="btn btn-danger"
                       onclick="return confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï¼')">
                        <i class="fas fa-trash"></i> åˆ é™¤ä»»åŠ¡
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å­—ç¬¦è®¡æ•°å™¨
        const textarea = document.getElementById('content');
        const charCount = document.getElementById('char-count');

        textarea.addEventListener('input', function() {
            const count = this.value.length;
            charCount.textContent = count;
            
            // å­—ç¬¦æ•°æ¥è¿‘é™åˆ¶æ—¶å˜è‰²æé†’
            if (count > 180) {
                charCount.style.color = '#ff4757';
            } else if (count > 150) {
                charCount.style.color = '#ffa502';
            } else {
                charCount.style.color = '#747d8c';
            }
        });

        // å…³é—­flashæ¶ˆæ¯
        document.querySelectorAll('.close-flash').forEach(button => {
            button.addEventListener('click', function() {
                this.parentElement.style.display = 'none';
            });
        });

        // è‡ªåŠ¨éšè—flashæ¶ˆæ¯
        setTimeout(() => {
            document.querySelectorAll('.flash-message').forEach(msg => {
                msg.style.opacity = '0';
                setTimeout(() => msg.style.display = 'none', 300);
            });
        }, 5000);

        // é˜²æ­¢æ„å¤–ç¦»å¼€é¡µé¢
        let formChanged = false;
        textarea.addEventListener('input', () => formChanged = true);
        document.getElementById('priority').addEventListener('change', () => formChanged = true);

        window.addEventListener('beforeunload', function(e) {
            if (formChanged) {
                e.preventDefault();
                e.returnValue = '';
            }
        });

        // è¡¨å•æäº¤æ—¶å–æ¶ˆbeforeunloadæé†’
        document.querySelector('.edit-form').addEventListener('submit', () => {
            formChanged = false;
        });

        // å¢å¼ºæ—¶é—´æ˜¾ç¤ºçš„äº¤äº’æ€§
        document.querySelectorAll('.relative-time, .completion-badge').forEach(element => {
            element.addEventListener('mouseover', function() {
                this.style.transform = 'scale(1.1)';
                this.style.transition = 'transform 0.2s ease';
            });
            element.addEventListener('mouseout', function() {
                this.style.transform = 'scale(1)';
            });
        });

        // å®Œæˆä¿¡æ¯çš„åŠ¨ç”»æ•ˆæœ
        const completionInfo = document.querySelector('.completion-info');
        if (completionInfo) {
            completionInfo.style.animation = 'fadeInUp 0.6s ease-out';
        }

        // ä¸ºCSSæ·»åŠ åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            .relative-time {
                transition: all 0.2s ease;
            }
            .completion-badge {
                transition: all 0.2s ease;
                cursor: pointer;
            }
            .task-info p {
                margin-bottom: 8px;
            }
            .task-info p:last-child {
                margin-bottom: 0;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html> 